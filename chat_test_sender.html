<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>STOMP Chat Test</title>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  </head>
  <body>
    <h2>âœ… ì½˜ì†”(F12)ì—ì„œ ë¡œê·¸ í™•ì¸í•˜ì„¸ìš”.</h2>

    <script>
      // 1ï¸âƒ£ WebSocket ì—°ê²°
      const socket = new WebSocket("ws://localhost:8080/ws");
      const client = Stomp.over(socket);

      // 2ï¸âƒ£ í† í° ì„¤ì • (ì‹¤ì œ JWT í† í°ìœ¼ë¡œ êµì²´)
      const token =
        "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0amRndXMzNDg4QG5hdmVyLmNvbSIsImlhdCI6MTc0NzgxOTYxMywiZXhwIjoxNzQ3ODIxNDEzfQ.HaKJ1wfw0zjz6BlZsogqtU8E5p9xyQbIgnslZ17Ye88";

      // 3ï¸âƒ£ ì—°ê²° ì‹œë„
      client.connect({ Authorization: token }, function (frame) {
        console.log("ğŸ”— Connected:", frame);

        // 4ï¸âƒ£ êµ¬ë… : ì´ê±¸(topic/chatroom/2) êµ¬ë…í•œ ì‚¬ëŒì€ ë‹¤ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆëŠ”ë°, ì‚¬ìš©ìë¥¼ 1ëª…ìœ¼ë¡œ ì œí•œí•´ì„œ ê°œì¸ ì±„íŒ…ìœ¼ë¡œ ì‚¬ìš©í•  ì˜ˆì •
        client.subscribe(
          "/topic/chatroom/2",
          function (message) {
            console.log("ğŸ“¨ ë°›ì€ ë©”ì‹œì§€:", JSON.parse(message.body));
          },
          {
            Authorization: token, // ğŸ‘ˆ SUBSCRIBEì—ë„ í† í°ì„ ëª…ì‹œì ìœ¼ë¡œ ë„£ì–´ì•¼ í•¨
          }
        );

        // 5ï¸âƒ£ ë©”ì‹œì§€ ë°œì†¡ (ì›í•˜ë©´ 1~2ì´ˆ ë’¤ ì‹¤í–‰)
        setTimeout(() => {
          client.send(
            "/app/chat.sendMessage", // ë³´ë‚¼ë•ŒëŠ” ë¬´ì¡°ê±´ ì´ê±¸ë¡œ í˜¸ì¶œ(ê³ ì •)
            {
              Authorization: token,
            },
            JSON.stringify({
              roomId: 2,
              type: "TALK",
              content: "ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹", // ë©”ì„¸ì§€ ë‚´ìš©
            })
          );
        }, 1000);
        // êµ¬ë…ì€ í•œ ë²ˆë§Œ í•˜ê³ , ë©”ì„¸ì§€ ì „ì†¡ì€ 5ë²ˆë§Œ ë°˜ë³µí•˜ë©´ ë¨
      });
    </script>
  </body>
</html>
